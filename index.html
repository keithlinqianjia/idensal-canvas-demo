<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>idensal ‚Äî Canvas Demo (Doc-Accurate + Share)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>.no-scrollbar::-webkit-scrollbar{display:none}.no-scrollbar{-ms-overflow-style:none;scrollbar-width:none}</style>
</head>
<body class="bg-gray-50">
  <div id="root"></div>
  <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

  <script type="text/babel">
    const { useState, useRef, useEffect } = React;
    const EMOJI = {"Events":"üéâ","Cleaning":"üßπ","Heating & Gas":"üî•","Plumbing":"üö∞","Electrical & Smart":"üîå","Roofing & Gutters":"üè†","Windows & Doors":"ü™ü","Joinery & Finishes":"ü™µ","Handyman":"üõ†Ô∏è","Gardens & Driveways":"üåø","Removals & Waste":"üöö","Care (Children & Elderly)":"üë∂","Others":"‚ú®"};
    const emojiFor = (n) => EMOJI[n] || "‚ú®";
    const CATEGORIES_FULL = [
      { name:"Cleaning", subs:["Carpet & upholstery","Household cleaning","End of tenancy clean","After builders clean","Gutter/soffit clean","Jet-wash patios/drives","Other"] },
      { name:"Heating & Gas", subs:["Boiler service","CP12 (landlord)","Boiler repair callout","TRVs & balancing","System power flush","Smart thermostat fit","Other"] },
      { name:"Plumbing", subs:["Emergency leaks","Toilet repair/replace","Shower valve swap","Tap swap (kitchen/bath)","Leak trace & repair","Outdoor tap install","Other"] },
      { name:"Electrical & Smart", subs:["EICR (inspection)","Consumer unit upgrade","Electric shower fit","Oven/hob connection","Security/PIR lighting","EV charger install","Other"] },
      { name:"Roofing & Gutters", subs:["Gutter clear/repair","Moss remove & treat","Soffit/fascia repair","Velux/skylight reseal","Roof leak repair","Other"] },
      { name:"Windows & Doors", subs:["Misted unit replace","Composite door fit","Reseal & draught-proof","Lock/hinge/handle fix","Align/adjust doors","Conservatory repairs","Other"] },
      { name:"Joinery & Finishes", subs:["Plaster/skimming","Tiling (kitchen/bath)","Doors/skirting/arches","Stud wall/partition","Laminate/LVT flooring","Painting & decorating","Other"] },
      { name:"Handyman", subs:["Draught-proof doors","Silicone/grout refresh","Patch & paint touch-ups","Door plane/hinge/latch","Blinds/curtain tracks","TV mount & shelving","Other"] },
      { name:"Gardens & Driveways", subs:["Hedge cut/reduce","Jet-wash drive/patio","Fence/post repair","Garden clear-out","Decking build/repair","Driveway repairs","Other"] },
      { name:"Removals & Waste", subs:["Man & van (hourly)","Student/flat moves","Furniture dis/re-assemble","Bulky waste / HIPPO","House/loft/garage clear","Other"] },
      { name:"Care (Children & Elderly)", subs:["Babysitting","Holiday/backup cover","SEN-aware support","Elderly companionship","Personal care visits","Other"] },
      { name:"Events", subs:["Food & Drink","Food trucks","Markets","Experiences","Other"] },
      { name:"Others", subs:["Others"] },
    ];
    const PROS=[{handle:"sparkle.clean",displayName:"Sparkle Clean",title:"End-of-tenancy specialist",distance:"0.4 mi",short:"Deep clean ‚Ä¢ Windows",cat:"Cleaning",coords:{x:32,y:52},about:"Move-out deep cleans with guaranteed checklist.",avatar:"https://images.unsplash.com/photo-1506794778202-cad84cf45f1d?q=80&w=400&auto=format&fit=crop"}];
    const toMiles=(d)=>parseFloat(String(d).replace(/[^0-9.]/g,""))||0;

    const copyToClipboard = async (text) => { try { await navigator.clipboard.writeText(text); alert("Copied"); } catch(e){ alert("Copy failed"); } };

    function SimMap(){ return <div className="h-40 border rounded-2xl bg-blue-50 grid place-items-center text-gray-600">map</div> }

    function Messages(){ return <div className="p-4 text-sm text-gray-600">Chat stub (unchanged)</div> }

    function Categories({ onPick }){
      const [q,setQ]=useState("");
      return (
        <div className="p-4">
          <div className="mb-3 flex items-center gap-2 bg-white border rounded-2xl px-3 py-2 shadow-sm"><span>üîé</span><input value={q} onChange={(e)=>setQ(e.target.value)} className="flex-1 outline-none text-sm" placeholder="Search categories & subs" /></div>
          <div className="space-y-2">
            {CATEGORIES_FULL.map(c=>(
              <button key={c.name} className="w-full text-left p-3 border rounded-2xl bg-white" onClick={()=>onPick(c.name)}>{emojiFor(c.name)} {c.name}</button>
            ))}
          </div>
        </div>
      );
    }

    function Home({ onMore }){
      return (
        <div className="p-4">
          <div className="h-14 border-b bg-white/95 backdrop-blur -mx-4 px-4 mb-3 flex items-center justify-between">
            <div className="text-base font-semibold">idensal</div>
            <div className="text-xs text-gray-600">your neighborhood</div>
          </div>
          <div className="mx-0 mt-2 flex items-center gap-2 bg-white border rounded-2xl px-3 py-2 shadow">
            <span className="text-gray-400">üîé</span>
            <input className="flex-1 outline-none text-sm text-gray-700 placeholder-gray-400" placeholder="key words (e.g., cleaner, boiler engineer)" />
          </div>
          <div className="mt-3"><SimMap/></div>
          <div className="mt-3">
            {PROS.map(p=>(<div key={p.handle} className="p-3 border rounded-2xl bg-white"> @{p.handle}.uk ‚Äî {p.title}</div>))}
          </div>
          <div className="mt-3"><button className="px-3 py-1 rounded-full border text-sm bg-white" onClick={onMore}>‚ûï More</button></div>
        </div>
      )
    }

    function Profile(){
      const [published,setPublished]=useState(true);
      const [showInfo,setShowInfo]=useState(false);
      const [showShare,setShowShare]=useState(true); // open by default so you can see it immediately
      const [userHandle,setUserHandle]=useState("@sparkleclean_scotland");
      const qrRef = useRef(null);
      const cleanUser=userHandle.replace(/^@/,'').replace(/\.uk$/i,'');
      const shareUrl=(typeof window!=='undefined')?(window.location.origin+window.location.pathname+'?pro='+encodeURIComponent(cleanUser)):'https://example.com/?pro='+encodeURIComponent(cleanUser);

      useEffect(()=>{
        if(showShare && qrRef.current && window.QRCode){
          qrRef.current.innerHTML="";
          new QRCode(qrRef.current,{ text: shareUrl, width:160, height:160 });
        }
      },[showShare,shareUrl]);

      function downloadQR(){
        if(!qrRef.current) return;
        const img = qrRef.current.querySelector('img');
        const canvas = qrRef.current.querySelector('canvas');
        const el = img || canvas;
        if(!el) return alert('QR not ready yet');
        let dataURL = "";
        if (el.tagName && el.tagName.toLowerCase()==='img') dataURL = el.src;
        else dataURL = el.toDataURL('image/png');
        const a=document.createElement('a');
        a.href=dataURL; a.download=cleanUser+"_profile_qr.png"; document.body.appendChild(a); a.click(); a.remove();
      }

      return (
        <div className="absolute inset-0 overflow-y-auto">
          <div className="h-14 px-5 border-b shrink-0 flex items-center">
            <div className="flex items-center justify-between w-full">
              <div className="flex items-center gap-2">
                <span className="text-sm font-medium text-gray-900">Publish profile</span>
                <button aria-label="What is publish?" className="h-5 w-5 rounded-full border grid place-items-center text-[10px] text-gray-600" onClick={()=>setShowInfo(v=>!v)}>i</button>
              </div>
              <div className="flex items-center gap-2">
                <button className="px-3 py-1 text-xs font-medium rounded-xl border" onClick={()=>setShowShare(s=>!s)}>üîó Share</button>
                <div className="inline-flex rounded-xl overflow-hidden border">
                  <button className={"px-3 py-1 text-xs font-medium "+(published?"bg-gray-900 text-white":"bg-white text-gray-700")} onClick={()=>setPublished(true)}>ON</button>
                  <button className={"px-3 py-1 text-xs font-medium "+(!published?"bg-gray-900 text-white":"bg-white text-gray-700")} onClick={()=>setPublished(false)}>OFF</button>
                </div>
              </div>
            </div>
          </div>
          {showInfo ? (<div className="px-5 py-2 border-b text-xs text-gray-600">Publishing your profile makes it discoverable on the map and in search.</div>) : null}

          {showShare && (
            <div className="px-5 py-4 border-b bg-white">
              <div className="text-sm font-semibold text-gray-900 mb-2">Share your profile</div>
              <div className="space-y-3">
                <div>
                  <div className="text-xs text-gray-500 mb-1">Share address</div>
                  <div className="flex items-center gap-2">
                    <input className="flex-1 rounded-xl border px-3 py-2 text-sm" value={"@"+cleanUser+".uk"} readOnly />
                    <button className="px-3 py-2 rounded-xl border text-sm" onClick={()=>copyToClipboard("@"+cleanUser+".uk")}>Copy</button>
                  </div>
                </div>
                <div>
                  <div className="text-xs text-gray-500 mb-1">Share userlink</div>
                  <div className="flex items-center gap-2">
                    <input className="flex-1 rounded-xl border px-3 py-2 text-sm" value={shareUrl} readOnly />
                    <button className="px-3 py-2 rounded-xl border text-sm" onClick={()=>copyToClipboard(shareUrl)}>Copy</button>
                  </div>
                </div>
                <div>
                  <div className="text-xs text-gray-500 mb-2">QR code</div>
                  <div className="flex items-center gap-3">
                    <div ref={qrRef} className="rounded-2xl border p-2 bg-white"></div>
                    <button className="px-3 py-2 rounded-xl border text-sm" onClick={downloadQR}>Download QR</button>
                  </div>
                </div>
              </div>
            </div>
          )}

          <div className="px-5 pt-5 pb-2"><h2 className="text-lg font-semibold text-gray-900">@sparkleclean_scotland.uk</h2></div>
          <div className="px-5 pb-4 flex items-center gap-4">
            <div className="h-20 w-20 rounded-full bg-gray-200 ring-2 ring-gray-200 grid place-items-center text-lg">S</div>
            <div className="flex-1 min-w-0">
              <div className="text-base font-medium text-gray-900 truncate">Sparkle Clean</div>
              <button className="mt-1 text-sm text-gray-800 underline">Edit</button>
            </div>
          </div>
          <div className="px-5 pt-5">
            <h3 className="text-base font-semibold text-gray-900">About</h3>
            <p className="mt-2 text-sm text-gray-700 leading-relaxed">Professional home & Airbnb cleaners covering West End, City Centre, and Partick. Same-day slots available. Fully insured. Eco-friendly options on request.</p>
          </div>
        </div>
      )
    }

    function App(){
      const [tab,setTab]=useState("Profile");
      return (
        <div className="min-h-screen bg-gray-50 p-4">
          <div className="mx-auto max-w-[420px] rounded-3xl border border-gray-200 bg-white shadow-xl overflow-hidden">
            <div className="flex h-[780px] flex-col">
              <div className="flex-1 overflow-hidden relative">
                {tab==="Home" && <Home onMore={()=>setTab("Categories")}/>}
                {tab==="Categories" && <Categories onPick={()=>setTab("Home")}/>}
                {tab==="Chat" && <Messages/>}
                {tab==="Profile" && <Profile/>}
              </div>
              <nav className="grid grid-cols-4 border-t bg-white">
                {["Home","Categories","Chat","Profile"].map(l=>(
                  <button key={l} className={"h-14 text-xs "+(tab===l?"font-semibold text-gray-900":"text-gray-500")+" flex flex-col items-center justify-center gap-0.5"} onClick={()=>setTab(l)}>
                    <span className="text-lg leading-none">{l==="Home"?"üè†":l==="Categories"?"üóÇÔ∏è":l==="Chat"?"üí¨":"üë§"}</span><span>{l}</span>
                  </button>
                ))}
              </nav>
            </div>
          </div>
        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
